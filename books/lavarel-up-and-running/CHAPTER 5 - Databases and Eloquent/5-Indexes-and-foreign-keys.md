<!-- @format -->

# Indexes and foreign keys

- Indexes though we can do without them are pretty important for **performance optimization** and for some **data integrity controls** with regard to **related tables**

## Adding indexes

- 3 ways to create indexes `index()`, `unique()`, `primary()`

```php
// After columns are created...

$table->primary('primary_id'); // Primary key; not necessary if using increments() or it's variations
$table->primary(['first_name', 'last_name']); // Composite keys

$table->unique('email'); // Unique index
$table->unique('email', 'optional_custom_index_name'); // Unique index

$table->index('amount'); // Basic index
$table->index('amount', 'optional_custom_index_name'); // Basic index
```

## Removing indexes

- 3 ways to remove indexes `dropIndex()`, `dropUnique()`, `dropPrimary()`

```php
$table->dropPrimary('contacts_id_primary');
$table->dropUnique('contacts_email_unique');
$table->dropIndex('optional_custom_index_name');

// If you pass an array of column names to dropIndex, it will
// guess the index names for you based on the generation rules
$table->dropIndex(['email', 'amount']);
```

## Adding and removing foreign keys

- To add a foreign key that defines that a particular column references a column on another table

```php
$table->foreign('user_id')->references('id')->on('users');
```

- to specify foreign key constraints, we can do that too, with `cascadeOnUpdate()`, `restrictOnUpdate()`, `cascadeOnDelete()`, `restrictOnDelete()`, and `nullOnDelete()`

```php
$table->foreign('user_id')
 ->references('id')
 ->on('users')
 ->cascadeOnDelete();

// Is same as above
$table->foreignId('user_id')->constrained()->cascadeOnDelete();
```

## Drop foreign keys

To drop a foreign key, we can either

1. delete it by referencing its index name (which is automatically generated by combining the names of the columns and tables being referenced)

```php
$table->dropForeign('contacts_user_id_foreign');
```

OR

2. by passing it an array of the fields that itâ€™s referencing in the local table

```php
$table->dropForeign(['user_id']);
```
